<!-- offers-list.component.html -->
<div class="flex flex-col h-full">
  <app-loading-bar [reloading]="reloading()"></app-loading-bar>

  <!-- Header toolbar -->
  <mat-toolbar color="primary" class="shadow-sm sticky top-0 z-20">
    <mat-toolbar-row class="container mx-auto !px-4 !py-3 gap-3 flex-wrap !h-auto !min-h-fit">
      <span class="text-xl font-semibold flex-1">{{ 'OFFER.Title' | translate }}</span>
      <!-- Action buttons -->
      <div class="flex flex-wrap gap-3">
        <button
          mat-fab
          extended
          color="primary"
          routerLink="./create">
          <mat-icon>add</mat-icon>
          {{ 'OFFER.Action.CreateSingle' | translate }}
        </button>

        <button
          mat-fab
          extended
          routerLink="./create/series">
          <mat-icon>playlist_add</mat-icon>
          {{ 'OFFER.Action.CreateSeries' | translate }}
        </button>

        <button
          mat-fab
          extended
          routerLink="./create/range">
          <mat-icon>format_list_bulleted_add</mat-icon>
          {{ 'OFFER.Action.CreateRange' | translate }}
        </button>
      </div>
    </mat-toolbar-row>
  </mat-toolbar>

  <!-- Filters section below toolbar -->
  <div class="shadow-sm border-b sticky top-16 z-10">
    <div class="container mx-auto px-4 py-4">
      <div class="flex flex-wrap items-center gap-4">

        <mat-form-field class="flex-1 min-w-[300px]" subscriptSizing="dynamic" appearance="fill">
          <mat-label>{{ 'DAY_INFO.SelectRange.Title' | translate }}</mat-label>
          <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
            <input matStartDate formControlName="start"
                   placeholder="{{ 'DAY_INFO.SelectRange.StartDate' | translate }}">
            <input matEndDate formControlName="end" placeholder="{{ 'DAY_INFO.SelectRange.EndDate' | translate }}">
          </mat-date-range-input>
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-date-range-picker #picker></mat-date-range-picker>

          @if (range.controls.start.hasError('matStartDateInvalid')) {
            <mat-error>Invalid start date</mat-error>
          }
          @if (range.controls.end.hasError('matEndDateInvalid')) {
            <mat-error>Invalid end date</mat-error>
          }
        </mat-form-field>

        @if (range.valid) {
          <button
            mat-icon-button
            (click)="clearSelection()"
            color="warn"
            matTooltip="{{ 'OFFER.Action.ClearFilter' | translate }}">
            <mat-icon>close</mat-icon>
          </button>
        }

        <div class="flex-1"></div>

        <!-- Summary info -->
        <div class="text-sm font-medium self-center opacity-70">
          {{ 'OFFER.Info.TotalOffers' | translate }}:
          <span class="font-semibold opacity-100">{{ totalElements() }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Table section -->
  <div class="flex-1 overflow-auto">
    <div class="container mx-auto px-4 py-6">
      <mat-card class="!rounded-2xl overflow-hidden">
        <table mat-table [dataSource]="offer()" class="w-full">
          <!-- Start column -->
          <ng-container matColumnDef="start">
            <th mat-header-cell *matHeaderCellDef class="!font-semibold !text-base">
              {{ 'OFFER.Field.Start' | translate }}
            </th>
            <td mat-cell *matCellDef="let offer" class="!py-4">
              <div class="flex items-center gap-3">
                <mat-icon class="!text-base">event</mat-icon>
                <span class="text-sm">{{ offer.start | date:'short' }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Finish column -->
          <ng-container matColumnDef="finish">
            <th mat-header-cell *matHeaderCellDef class="!font-semibold !text-base">
              {{ 'OFFER.Field.Finish' | translate }}
            </th>
            <td mat-cell *matCellDef="let offer" class="!py-4">
              <div class="flex items-center gap-3">
                <mat-icon class="!text-base">event_available</mat-icon>
                <span class="text-sm">{{ offer.finish | date:'short' }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Max Persons column -->
          <ng-container matColumnDef="maxPersons">
            <th mat-header-cell *matHeaderCellDef class="!font-semibold !text-base">
              {{ 'OFFER.Field.MaxPersons' | translate }}
            </th>
            <td mat-cell *matCellDef="let offer" class="!py-4">
              <div class="flex items-center gap-3">
                <mat-icon class="!text-base">people</mat-icon>
                <mat-chip highlighted>
                  {{ offer.maxPersons }}
                </mat-chip>
              </div>
            </td>
          </ng-container>

          <!-- Active column -->
          <ng-container matColumnDef="active">
            <th mat-header-cell *matHeaderCellDef class="!font-semibold !text-base">
              {{ 'OFFER.Field.Active' | translate }}
            </th>
            <td mat-cell *matCellDef="let offer" class="!py-4">
              @switch (getOfferMode(offer)) {
                @case ('active') {
                  <div class="w-24">
                    <mat-progress-bar mode="indeterminate" color="primary"></mat-progress-bar>
                  </div>
                }
                @default {
                  <div
                    (click)="toggleActive(offer)"
                    class="cursor-pointer inline-block"
                    [class.opacity-50]="reloading()">
                    <mat-slide-toggle
                      [checked]="offer.active"
                      [disabled]="reloading()"
                      color="primary">
                    </mat-slide-toggle>
                  </div>
                }
              }
            </td>
          </ng-container>

          <!-- Actions column -->
          <ng-container matColumnDef="cmd">
            <th mat-header-cell *matHeaderCellDef class="!font-semibold !text-base !w-36">
              {{ 'OFFER.Field.Actions' | translate }}
            </th>
            <td mat-cell *matCellDef="let offer" class="!py-4">
              <div class="flex items-center gap-1">
                <button
                  mat-icon-button
                  routerLink="./edit/{{ offer.id }}"
                  matTooltip="{{ 'OFFER.Action.Edit' | translate }}">
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  (click)="delete(offer)"
                  matTooltip="{{ 'OFFER.Action.Delete' | translate }}"
                  color="warn">
                  <mat-icon>delete</mat-icon>
                </button>
                <button
                  mat-icon-button
                  routerLink="./details/{{ offer.id }}"
                  matTooltip="{{ 'OFFER.Action.Details' | translate }}">
                  <mat-icon>more_horiz</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns;"
            class="hover:opacity-80 transition-opacity">
          </tr>
        </table>

        <!-- Empty state -->
        @if (offer().length === 0 && !reloading()) {
          <div class="py-20 text-center">
            <div class="inline-flex items-center justify-center w-24 h-24 rounded-full mb-6">
              <mat-icon class="!w-16 !h-16 !text-6xl opacity-50" color="primary">inbox</mat-icon>
            </div>
            <h3 class="text-xl font-semibold mb-2">
              {{ 'OFFER.Empty.Title' | translate }}
            </h3>
            <p class="opacity-70 mb-8 max-w-md mx-auto">
              {{ 'OFFER.Empty.Description' | translate }}
            </p>
            <button mat-fab extended color="primary" routerLink="./create">
              <mat-icon>add</mat-icon>
              {{ 'OFFER.Action.CreateFirst' | translate }}
            </button>
          </div>
        }
      </mat-card>
    </div>
  </div>

  <!-- Paginator -->
  <div class="border-t sticky bottom-0">
    <mat-paginator
      [length]="totalElements()"
      [pageSize]="pageSize()"
      [pageIndex]="pageNumber()"
      [pageSizeOptions]="[10, 25, 50, 100]"
      [showFirstLastButtons]="true"
      [disabled]="reloading()"
      (page)="handlePageChange($event)">
    </mat-paginator>
  </div>
</div>
