<div class="flex flex-col h-full">
  <div class="flex-shrink-0">
    <app-loading-bar [reloading]="reloading()"/>
  </div>
  <div class="flex flex-col flex-1 min-h-0 p-4">
    <div class="flex flex-col h-full space-y-4">
      <!-- Filters -->
      <div class="bg-white p-4 rounded-lg shadow-sm space-y-4 flex-shrink-0">
        <div class="flex gap-2 items-start">
          <mat-form-field class="flex-1 min-w-[300px] dense-3" subscriptSizing="dynamic" appearance="outline">
            <mat-label>{{ 'DAY_INFO.SelectRange.Title' | translate }}</mat-label>
            <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
              <input matStartDate formControlName="start"
                     placeholder="{{ 'DAY_INFO.SelectRange.StartDate' | translate }}">
              <input matEndDate formControlName="end" placeholder="{{ 'DAY_INFO.SelectRange.EndDate' | translate }}">
            </mat-date-range-input>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
          </mat-form-field>
          @if (range.valid) {
            <button
              mat-icon-button
              (click)="clearSelection()"
              class="!text-red-600 hover:!bg-red-50 mt-1"
              matTooltip="{{ 'OFFER.Action.ClearFilter' | translate }}">
              <mat-icon>close</mat-icon>
            </button>
          }
        </div>
        <div>
          <div class="flex gap-2 flex-wrap">
            @for (size of visitorSizes; track size.value) {
              <button
                matButton="tonal"
                class="!border-gray-300 !text-gray-700 hover:!bg-gray-50"
                [class.!bg-blue-50]="visitorSize() === size.value"
                [class.!border-blue-500]="visitorSize() === size.value"
                [class.!text-blue-700]="visitorSize() === size.value"
                (click)="visitorSize.set(size.value)">
                {{ size.label | translate }} ({{ size.value }})
              </button>
            }
          </div>
        </div>
      </div>
      <!-- Offers List - Scrollable -->
      <div class="flex-1 overflow-y-auto min-h-0">
        <div class="space-y-4 pr-2">
          @for (dayGroup of entries(); track dayGroup.day) {
            <div>
              <h3 class="text-sm font-medium text-gray-500 mb-2">
                {{ dayGroup.day | date: 'EEE, dd.MM.yyyy' }}
              </h3>
              <div class="space-y-2">
                @for (item of dayGroup.entries; track item.offer.id) {
                  <div
                    class="bg-white p-3 rounded-lg border-2 border-gray-200 transition-all cursor-pointer hover:border-gray-300"
                    [class.opacity-50]="!item.offer.active"
                    [class.!border-blue-500]="selectedOfferId() === item.offer.id"
                    [class.!bg-blue-50]="selectedOfferId() === item.offer.id"
                    (click)="selectOffer(item)">
                    <div class="flex items-center justify-between gap-3">
                      <div class="flex items-center gap-3 min-w-0 flex-1">
                        <div class="flex flex-col">
                        <span class="text-sm font-medium" [class.text-gray-400]="!item.offer.active">
                          {{ item.offer.start | date: 'HH:mm' }} - {{ item.offer.finish | date: 'HH:mm' }}
                        </span>
                          @if (!item.offer.active) {
                            <span class="text-xs text-gray-400">{{ 'OFFER.INACTIVE' | translate }}</span>
                          }
                        </div>
                      </div>
                      <div class="flex-shrink-0 min-w-[120px]">
                        <app-offer-assignment [assignment]="item.assignment"/>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
