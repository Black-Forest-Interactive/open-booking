<div [class]="isConfirmed()
  ? 'rounded border-2 border-green-200 bg-green-50'
  : 'rounded border-2 border-amber-200 bg-amber-50'">

  <!-- Booking Header -->
  <div class="flex items-center justify-between p-2">
    <div class="flex items-center gap-2 flex-1">
      <mat-icon [class]="isConfirmed() ? 'text-green-600' : 'text-amber-600'" inline>
        {{ isConfirmed() ? 'check_circle' : 'cancel' }}
      </mat-icon>

      <div class="flex-1">
        <div class="font-medium text-gray-800 text-sm">
          {{ reservation().visitor.title }}
        </div>
        <div class="text-xs text-gray-600">
          {{ reservation().visitor.size }} {{ reservation().visitor.size === 1 ? 'guest' : 'guests' }}
        </div>
      </div>
    </div>

    <div class="flex items-center gap-2">
      <!-- Email Status Icon -->
      @if (emailSent()) {
        <mat-icon
          [matTooltip]="emailDelivered() ? 'Email delivered' : 'Email sent, pending delivery'"
          [class]="emailDelivered() ? 'text-green-600' : 'text-gray-400'" inline>
          {{ emailDelivered() ? 'mark_email_read' : 'mail' }}
        </mat-icon>
      }

      <!-- Details Button -->
      <button matButton="tonal" color="primary" (click)="showDetails()" class="!px-3 !py-1 !text-xs !min-w-0 !h-7">
        Details
      </button>

      <!-- Expand Button -->
      <button matIconButton (click)="toggleExpand()">
        <mat-icon class="text-gray-600">
          {{ isExpanded() ? 'expand_less' : 'expand_more' }}
        </mat-icon>
      </button>
    </div>
  </div>

  <!-- Booking Details (Expanded) -->
  @if (isExpanded()) {
    <div class="border-t border-gray-200 p-3 space-y-2 bg-white/50">
      <!-- Email -->
      <div class="flex items-start gap-2 text-sm">
        <mat-icon class="text-gray-500" inline>mail</mat-icon>
        <div>
          <div class="text-gray-600 text-xs">Email</div>
          <div class="text-gray-800">{{ reservation().visitor.email }}</div>
        </div>
      </div>

      <!-- Phone -->
      <div class="flex items-start gap-2 text-sm">
        <mat-icon class="text-gray-500" inline>phone</mat-icon>
        <div>
          <div class="text-gray-600 text-xs">Phone</div>
          <div class="text-gray-800">{{ reservation().visitor.phone }}</div>
        </div>
      </div>

      <!-- Address -->
      <div class="flex items-start gap-2 text-sm">
        <mat-icon class="text-gray-500" inline>location_on</mat-icon>
        <div>
          <div class="text-gray-600 text-xs">Address</div>
          <div class="text-gray-800">{{ reservation().visitor.address | address }}</div>
        </div>
      </div>

      <!-- Comment -->
      @if (comment()) {
        <div class="flex items-start gap-2 text-sm">
          <mat-icon class="text-gray-500" inline>comment</mat-icon>
          <div>
            <div class="text-gray-600 text-xs">Comment</div>
            <div class="text-gray-800">{{ comment() }}</div>
          </div>
        </div>
      }

      <!-- Email Status -->
      <div class="pt-2 border-t border-gray-200">
        <div class="text-xs text-gray-600">Email Status</div>
        <div class="flex items-center gap-2 mt-1">
          @if (emailSent()) {
            <mat-icon class="!text-xs text-green-600" inline>check_circle</mat-icon>
            <span class="text-xs text-gray-800">
              Email sent {{ emailDelivered() ? '& delivered' : '' }}
            </span>
          } @else {
            <mat-icon class="!text-xs text-red-600" inline>cancel</mat-icon>
            <span class="text-xs text-gray-800">Email not sent</span>
          }
        </div>
      </div>
    </div>
  }
</div>
