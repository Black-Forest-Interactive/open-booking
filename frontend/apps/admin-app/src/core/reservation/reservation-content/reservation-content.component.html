<div class="flex flex-col gap-6">
  @for (group of groupedEntries(); track group.date + '-' + group.offerId) {
    <div class="bg-white rounded-lg shadow-sm border border-gray-300">
      <!-- Group Header -->
      <div class="bg-gray-100 px-4 py-3 border-b border-gray-200 rounded-t-lg">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <div class="flex items-center gap-2">
              <mat-icon class="text-gray-600">event</mat-icon>
              <span class="font-semibold text-gray-800">{{ group.date | date:'fullDate' }}</span>
            </div>
            <div class="text-sm text-gray-600">
              {{ group.timeRange }}
            </div>
          </div>
          <div class="flex items-center gap-4">
            <div class="text-sm bg-white px-3 py-1 rounded-full shadow-sm border border-gray-200">
              <span class="font-medium">{{ group.totalEntries }}</span>
              <span class="text-gray-600 ml-1">{{ 'RESERVATION.Total' | translate }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Reservations List -->
      <div class="divide-y divide-gray-200">
        @for (entry of group.entries; track entry.booking.id) {
          <div class="px-4 py-3 hover:bg-gray-50 transition-colors"
               [class.bg-amber-50]="entry.editor"
               [class.border-l-4]="entry.editor"
               [class.border-l-amber-400]="entry.editor">
            <div class="flex flex-col xl:flex-row lg:items-start lg:justify-between gap-6">

              <!-- Left Section: Status & Visitor Info -->
              <div class="flex flex-col items-stretch gap-4 min-w-0 flex-1">
                <div class="flex gap-2">
                  <lib-booking-status [status]="entry.booking.status"/>
                  <lib-verification-status [data]="entry.visitor.verification"/>
                  <lib-visitor-type [data]="entry.visitor.type" class="flex-shrink-0"/>
                </div>
                <div class="flex gap-4 items-center">

                  <app-visitor-title [data]="entry.visitor" class="font-semibold text-gray-900"/>
                  <app-visitor-size [visitor]="entry.visitor"></app-visitor-size>
                </div>
                <div class="flex flew-wrap gap-2 text-sm text-gray-600">

                  <div class="flex items-center gap-2">
                    <mat-icon class="text-base text-gray-400" inline>email</mat-icon>
                    <a [href]="'mailto:' + entry.visitor.email"
                       class="hover:text-primary hover:underline">
                      {{ entry.visitor.email }}
                    </a>
                  </div>
                  <div class="flex items-center gap-2">
                    <mat-icon class="text-base text-gray-400" inline>phone</mat-icon>
                    <a [href]="'tel:' + entry.visitor.phone"
                       class="hover:text-primary hover:underline">
                      {{ entry.visitor.phone }}
                    </a>
                  </div>
                </div>


              </div>

              <!-- Middle Section: Capacity & Timestamp -->
              <app-offer-booking-capacity
                [offer]="entry.offer.offer"
                [visitorSize]="entry.visitor.size"
                [status]="entry.booking.status"
                [assignment]="entry.offer.assignment"
                class="flex-1"
              />

              <!-- Right Section: Editor & Actions -->
              <div
                class="flex lg:flex-col items-center justify-between lg:justify-end gap-3 flex-shrink-0 min-w-[160px]">

                <!-- Current Editor Badge -->
                <app-editor-info [editor]="entry.editor"/>

                <!-- Action Button -->
                <app-reservation-edit-button [entry]="entry" [currentUserId]="currentUserId()"/>

                <div class="flex gap-2 text-xs text-gray-500 text-center">
                  <div class="font-medium">{{ 'RESERVATION.Created' | translate }}</div>
                  <div>{{ getTimestamp(entry) | date:'short' }}</div>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  }

  @if (groupedEntries().length === 0) {
    <div class="text-center py-12 text-gray-500">
      <mat-icon class="text-6xl mb-4">inbox</mat-icon>
      <p>{{ 'RESERVATION.NoReservations' | translate }}</p>
    </div>
  }
</div>
