<!-- Capacity Bar -->
<div class="flex flex-col gap-2">
  <div class="flex justify-between text-sm font-medium text-gray-700">
    <span>{{ 'RESERVATION.Offer.Capacity.Label' | translate }}</span>
    <span>{{ usedCapacity() }} / {{ maxPersons() }}</span>
  </div>

  <div class="relative h-6 bg-green-500 rounded-lg overflow-hidden border border-gray-300">
    <!-- Booked Space (Blue) -->
    <div class="absolute h-full bg-blue-500 transition-all"
         [style.width.%]="bookedPercentage()">
    </div>

    <!-- Other Reserved Space (Orange) - excluding current visitor -->
    <div class="absolute h-full bg-orange-400 transition-all"
         [style.left.%]="bookedPercentage()"
         [style.width.%]="otherReservedPercentage()">
    </div>

    <!-- Current Visitor Group (Purple) - only if UNCONFIRMED -->
    @if (isUnconfirmed()) {
      <div class="absolute h-full bg-purple-500 transition-all border-l-2 border-r-2 border-purple-700"
           [style.left.%]="bookedPercentage() + otherReservedPercentage()"
           [style.width.%]="visitorPercentage()">
      </div>
    }

    <!-- Capacity Numbers Overlay -->
    <div class="absolute inset-0 flex items-center justify-center">
      <div class="flex gap-4 text-xs font-semibold text-white drop-shadow-md">
        <span>{{ bookedSpace() }}</span>
        <span>{{ reservedSpace() }}</span>
        <span>{{ availableSpace() }}</span>
      </div>
    </div>
  </div>

  <!-- Legend -->
  <div class="flex flex-wrap gap-3 text-xs">
    <div class="flex items-center gap-1">
      <div class="w-4 h-4 bg-blue-500 rounded border border-blue-600"></div>
      <span class="text-gray-700">
                {{ 'RESERVATION.Offer.Stats.Booked' | translate }} ({{ bookedSpace() }})
              </span>
    </div>
    <div class="flex items-center gap-1">
      <div class="w-4 h-4 bg-orange-400 rounded border border-orange-500"></div>
      <span class="text-gray-700">
                {{ 'RESERVATION.Offer.Stats.Reserved' | translate }} ({{ otherReservedSpace() }})
              </span>
    </div>
    @if (isUnconfirmed()) {
      <div class="flex items-center gap-1">
        <div class="w-4 h-4 bg-purple-500 rounded border border-purple-700"></div>
        <span class="text-gray-700 font-medium">
                  {{ 'RESERVATION.Offer.Stats.CurrentGroup' | translate }} ({{ visitor().size }})
                </span>
      </div>
    }
    <div class="flex items-center gap-1">
      <div class="w-4 h-4 bg-green-200 rounded border border-green-300"></div>
      <span class="text-gray-700">
                {{ 'RESERVATION.Offer.Stats.Available' | translate }} ({{ availableSpace() }})
              </span>
    </div>
  </div>
  <!-- Capacity Impact Info -->
  @if (isUnconfirmed() && hasCapacity()) {
    <div class="p-2 bg-purple-50 border border-purple-200 rounded-lg">
      <div class="flex items-start gap-2 text-xs text-purple-800">
        <mat-icon class="shrink-0" inline>info</mat-icon>
        <div class="min-w-0 whitespace-normal break-words overflow-wrap-anywhere">
          {{
            'RESERVATION.Offer.Info.ConfirmationEffect' | translate:{
              size: visitor().size,
              remaining: remainingAfterConfirmation()
            }
          }}
        </div>
      </div>
    </div>
  }
</div>
